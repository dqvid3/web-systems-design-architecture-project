<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="style.css" rel="stylesheet"/>

</head>
<body>
<header>
    <div sec:authorize="isAuthenticated()">
        Welcome <b><span sec:authentication="name">Username</span></b>
        &nbsp;
        <i><span sec:authentication="principal.authorities">Roles</span></i>
    </div>
    <div>
        <form th:action="@{/logout}" method="post">
            <input type="submit" value="Logout"/>
        </form>
    </div>
</header>
<main>
    <div class="filtri">
        <h1>Genera Report</h1>
        <form th:action="@{/reportistica}" method="post" id="generaReport">
            <div>
                <label for="dateRange">Intervallo di Date</label>
                <select id="dateRange" name="dateRange" th:value="Oggi" onchange="setDateRange(this.value)">
                    <option value="Oggi" th:selected="${dateRange == 'Oggi'}">Oggi</option>
                    <option value="Ieri" th:selected="${dateRange == 'Ieri'}">Ieri</option>
                    <option value="Ultima settimana" th:selected="${dateRange == 'Ultima settimana'}">Ultima settimana
                    </option>
                    <option value="Ultimo mese" th:selected="${dateRange == 'Ultimo mese'}">Ultimo mese</option>
                    <option value="Ultimo anno" th:selected="${dateRange == 'Ultimo anno'}">Ultimo anno</option>
                    <option value="custom" th:selected="${dateRange == 'custom'}">Intervallo personalizzato</option>
                </select>
            </div>

            <div id="customDates" th:class="${dateRange == 'custom' ? '' : 'hidden'}">
                <label for="startDate">Data Inizio</label>
                <input type="datetime-local" id="startDate" name="startDate" th:value="${startDate}" required>
                <br/>
                <label for="endDate">Data Fine</label>
                <input type="datetime-local" id="endDate" name="endDate" th:value="${endDate}" required>
            </div>
            <div>
                <label for="cartelloneName">Seleziona Cartellone/i</label>
                <select id="cartelloneName" name="cartelloneName" required>
                    <option value="%">Tutti i Cartelloni</option>
                    <option th:each="cartellone : ${cartelloni}"
                            th:value="${cartellone.nome}"
                            th:text="${cartellone.nome}"
                            th:selected="${cartellone.nome == cartelloneName}">
                    </option>
                </select>
            </div>
            <div>
                <label for="operator">Operatore</label>
                <select id="operator" name="operator" th:value="COUNT" required>
                    <option value="COUNT" th:selected="${operator == 'LIST'}">Lista</option>
                    <option value="COUNT" th:selected="${operator == 'COUNT'}">Conteggio</option>
                    <option value="AVG" th:selected="${operator == 'AVG'}">Media</option>
                    <option value="SUM" th:selected="${operator == 'SUM'}">Somma</option>
                    <option value="MAX" th:selected="${operator == 'MAX'}">Massimo</option>
                    <option value="MIN" th:selected="${operator == 'MIN'}">Minimo</option>
                </select>
            </div>
            <div>
                <label for="sortOrder">Ordinamento</label>
                <select id="sortOrder" name="sortOrder" th:value="ASC">
                    <option value="ASC" th:selected="${sortOrder == 'ASC'}">Ascendente</option>
                    <option value="DESC" th:selected="${sortOrder == 'DESC'}">Discendente</option>
                </select>
            </div>
            <div>
                <label for="minViews">Visualizzazioni Minime</label>
                <input type="number" id="minViews" name="minViews" min="0" th:value="${minViews != null ? minViews : 0}"
                       required>
            </div>
            <div>
                <label for="limit">Numero di Risultati</label>
                <input type="number" id="limit" name="limit" min="1" th:value="${limit != null ? limit : 1000}"
                       required>
            </div>
            <div>
                <button type="submit">Genera</button>
            </div>
            <div>
                <button type="button" onclick="setDefaultParams()">Reset</button>
            </div>
        </form>
    </div>
    <div class="risultati">
        <h2>Risultati</h2>
        <div th:if="${results != null}">
            <h3 th:text="${dateRange == 'custom' ?  (startDate + ' - ' + endDate) : dateRange}"/>
            <table>
                <thead>
                <tr>
                    <th>Ref Cartellone</th>
                    <th>Nome</th>
                    <th th:if="${operator == 'LIST'}">bo Visualizzazioni</th>
                    <th th:if="${operator == 'COUNT'}">Numero Visualizzazioni</th>
                    <th th:if="${operator == 'AVG'}">Durata Media Visualizzazioni</th>
                    <th th:if="${operator == 'SUM'}">Durata Totale Visualizzazioni</th>
                    <th th:if="${operator == 'MAX'}">Durata Massima Visualizzazione</th>
                    <th th:if="${operator == 'MIN'}">Durata Minima Visualizzazione</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="report : ${results}">
                    <td th:text="${report.refCartellone}">Ref Cartellone</td>
                    <td th:text="${report.nome}">Nome</td>
                    <td th:text="${report.risultato}">Risultato</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="esporta">

    </div>
</main>
</body>
</html>