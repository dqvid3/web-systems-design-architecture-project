<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Reportistica</title>
</head>
<body>
<h1>Genera Report</h1>
<form th:action="@{/reportistica}" method="post">
    <label for="startDate">Data Inizio:</label>
    <input type="datetime-local" id="startDate" name="startDate" th:value="${startDate}" required>

    <label for="endDate">Data Fine:</label>
    <input type="datetime-local" id="endDate" name="endDate" th:value="${endDate}" required>

    <label for="cartelloneName">Nome Cartellone:</label>
    <select id="cartelloneName" name="cartelloneName" required>
        <option value="%">Tutti i Cartelloni</option>
        <option th:each="cartellone : ${cartelloni}"
                th:value="${cartellone.nome}"
                th:text="${cartellone.nome}"
                th:selected="${cartellone.nome == cartelloneName}">
        </option>
    </select>

    <label for="operator">Operatore:</label>
    <select id="operator" name="operator" th:value="COUNT" required>
        <option value="COUNT" th:selected="${operator == 'COUNT'}">Conteggio</option>
        <option value="AVG" th:selected="${operator == 'AVG'}">Media</option>
        <option value="SUM" th:selected="${operator == 'SUM'}">Somma</option>
        <option value="MAX" th:selected="${operator == 'MAX'}">Massimo</option>
        <option value="MIN" th:selected="${operator == 'MIN'}">Minimo</option>
        <!-- <option value="MIN" th:selected="${operator == ''}">Elenca</option> -->
    </select>

    <label for="sortOrder">Ordine:</label>
    <select id="sortOrder" name="sortOrder">
        <option value="ASC" th:selected="${sortOrder == 'ASC'}">Ascendente</option>
        <option value="DESC" th:selected="${sortOrder == 'DESC'}">Discendente</option>
    </select>

    <label for="minViews">Visualizzazioni Minime:</label>
    <input type="number" id="minViews" name="minViews" min="0" th:value="${minViews}" required>

    <label for="limit">Numero di Risultati:</label>
    <input type="number" id="limit" name="limit" min="1" th:value="${limit}" required>

    <button type="submit">Genera Report</button>
</form>

<h2>Risultati</h2>
<div th:if="${results != null}">
    <table>
        <thead>
        <tr>
            <th>Ref Cartellone</th>
            <th>Nome</th>
            <th th:if="${operator == 'COUNT'}">Numero Visualizzazioni</th>
            <th th:if="${operator == 'AVG'}">Durata Media Visualizzazioni</th>
            <th th:if="${operator == 'SUM'}">Durata Totale Visualizzazioni</th>
            <th th:if="${operator == 'MAX'}">Durata Massima Visualizzazione</th>
            <th th:if="${operator == 'MIN'}">Durata Minima Visualizzazione</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="report : ${results}">
            <td th:text="${report.refCartellone}">Ref Cartellone</td>
            <td th:text="${report.nome}">Nome</td>
            <td th:text="${report.risultato}">Risultato</td>
        </tr>
        </tbody>
    </table>
</div>

<h2>Esporta</h2>
<form th:action="@{/reportistica/esporta}" method="get">
    <label for="formato">Formato:</label>
    <select id="formato" name="formato">
        <option value="pdf">PDF</option>
        <option value="xlsx">Excel</option>
    </select>
    <button type="submit">Esporta</button>
</form>
</body>
</html>
